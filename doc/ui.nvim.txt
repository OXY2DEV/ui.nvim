*ui.nvim*            A blueprint/template/guide for ricing Neovim's UI using Lua

------------------------------------------------------------------------------
ðŸ“š Table of contents

  Configuration ............................................. |ui.nvim-config|

  Modifying Neovimâ€™s UI with lua ................................ |ui.nvim-ui|
  Guide: Command-line ...................................... |ui.nvim-cmdline|
  Guide: Messages ......................................... |ui.nvim-messages|
  Guide: Pop-up menu ..................................... |ui.nvim-popupmenu|

------------------------------------------------------------------------------
ðŸ“ Architecture

>txt
  ui.lua â”€â”€â”€ vim.ui_attach() â”¬â”¬â”€> cmdline.lua â”€â”€> handle() â”€â”€> state change â”€â”€> __render() | __close()
                             â”‚â””â”€> message.lua â”€â”€> handle() â”€â”€> __add() | __replace() | __confirm() | __list() â”€â”€> __render() 
                             â””â”€â”€> popup.lua   â”€â”€> handle() â”€â”€> state change â”€â”€> __render()
  
                             â”€â”€â”€> linegrid.lua â”€â”€> handle()
<

For the sake of making things easy to understand and simple to debug/test, the
plugin follows a simple tree-like file structure.

Itâ€™s flow is also linear(in most cases).

You can visualize the files like so,

>txt
       nvim
        â†“
  plugin/ui.lua
   â”‚    â†“
   â”‚  ui.lua â”¬â”¬â”¬â”€> cmdline.lua
   â”‚         â”‚â”‚â””â”€> message.lua 
   â”‚         â”‚â””â”€â”€> popup.lua 
   â”‚         â””â”€â”€â”€> linegrid.lua 
   â”‚
   â”‚              â”€>  log.lua  â”€>   # Logger connects to all the files.
   â”‚<â”€ utils.lua<â”€   # Utilities are used by all other files.
   â”‚
   â””â”€> highlight.lua
<

â–Œ To prevent needing to call `setup()`, the setup function gets called in
â–Œ `plugin/ui.lua`. Also, everything is loaded after `VimEnter` to reduce load
â–Œ time.

Everything starts at the `vim.ui_attach()` function in `ui.lua`. The UI events
captured by it gets sent to one of the sub-modules(`ui/cmdline.lua`,
`ui/message.lua`, `ui/popup.lua`, `ui/linegrid.lua`).

A map(see hereâ¶) is used to determine the sub-module an event is supposed to
go to.

------------------------------------------------------------------------------
ðŸ“ Event handling

Each sub-module has a `handle()` function for handling various event types. A
`setup()` function may optionally exist within the sub-module(s) that will get
called when the plugin loads.

Event callbacks wrapped in a `pcall()` to prevent internal errors from
disrupting the user.

ðŸ”° Command-line ~

The command-line(aka `cmdline.lua`) sub-module works by updating a
command-line state variable(see hereâ·).

The state later gets read by the `__render()` function which populates a
buffer with the necessary lines of text. This buffer then gets shown in a
window.

â–Œ In most cases the `__render()` function gets scheduled(instead of
â–Œ immediately executing). However, when commands have previews(e.g.Â `:s/`) it
â–Œ gets executed immediately.

ðŸ”° Messages ~

The messages sub-module(aka `message.lua`) works by using a table(see hereâ¸)
to store messages.

â–Œ Messages initially gets stored in the `message.visible` table which
â–Œ represents the messages that will be shown to the user. Each message entry
â–Œ later gets removed from this table, which hides them from the user.
â–Œ Most messages gets also stored in `message.history` table. You can view them
â–Œ via `:messages` command and using the internal message history.

ðŸ”° Completion ~

The completion sub-module(aka `popup.lua`) is used to show completions. It
works by maintaining a completion state(like the command-line).

When `__render()` gets called it reads each entry in the completion menu and
writes them to a buffer which gets shown in the completion/pop-up window.

ðŸ”° Line-grid ~

Currently has no use.

------------------------------------------------------------------------------

Link references ~

 6: https://github.com/OXY2DEV/ui.nvim/blob/4c2aeb8847677e318f835f710fdc7f0073c6f719/lua/ui.lua#L8-L42
 7: https://github.com/OXY2DEV/ui.nvim/blob/4c2aeb8847677e318f835f710fdc7f0073c6f719/lua/ui/cmdline.lua#L15-L24
 8: https://github.com/OXY2DEV/ui.nvim/blob/4c2aeb8847677e318f835f710fdc7f0073c6f719/lua/ui/message.lua#L34-L37


vim:ft=help:tw=78:ts=2:
